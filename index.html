<html> 
<head>
  <style>
   *{padding: 0; margin:0;}
   canvas{ background: #eee; display: block; margin: 0 auto;}
   </style>
</head>
<body>
<canvas id= "myCanvas" width="256" height="240"></canvas>
<script type="text/javascript">
let canvas = document.getElementById("myCanvas");
let ctx = canvas.getContext("2d");
document.addEventListener("keydown",keyDownHandler, false);
document.addEventListener("keyup",keyUpHandler,false);
document.body.style.zoom = "288%";
let rightPressed = false;
let leftPressed = false;
let upPressed = false;
let downPressed = false;
let worldTiles = new Image();
worldTiles.src = "tiles-overworld.png";
let link1 = new Image();
link1.src = "link.png";
let enemies = new Image();
enemies.src = "enemies.png";
let hud = new Image();
hud.src = "pausescreen.png";
let fps = 60;
let animationCounter = 0;
let currentAnimation = 0;
let animationSpeed = 10;
let lastButtonPressed = "up";
let linkY = 135;
let linkX = 116;
let linkHearts = 16;
let linkNeedsToBounce = false;
let currentLinkHearts = 11.5;
let blocks = [];
let gameObjects = [];
let gameAttacks
let gameMap = [];
let maps = [];
let isAttacking = false;
let canAttackAgain = true;
let pathFound = [];
let hasRun = false;
let hasSword = true;

function GameObject()
{
	this.x = 0;
	this.y = 0;
	this.width = 0;
	this.height = 0;
	this.newMap = 0;
	this.newLinkX = -1;
	this.newLinkY = -1;
	this.isPortal = false;
	this.isEnemy = false;
	this.enemyType = 0;
	this.nextX = 0;
	this.nextY = 0;
	this.isAttacking = false;
	this.health = 0;
	this.direction = "up";
	this.enemyPath = [];
	this.counter = 0;
	this.frame = 0;
	this.needsBounce = false;
	this.bounceX = 0;
	this.bounceY = 0;
}

///Portal variables
let gO = new GameObject()
gO.x = 72;
gO.y = 72;
gO.width = 8;
gO.height = 16;
gO.newMap = 1;
gO.newLinkX = 120;
gO.newLinkY = 220;
gO.isPortal = true;

let gameObjects7_7 = [];
gameObjects7_7.push(gO);

gO = new GameObject()
gO.x = 160;
gO.y = 184;
gO.nextX = 160;
gO.nextY = 184;
////row 10 col 13
gO.width = 16;
gO.height = 16;
gO.isEnemy = true;
gO.enemyType = 1;
gO.isAttacking = false;
gO.health = 1;
gO.direction = "up";
gameObjects7_7.push(gO);

gO = new GameObject()
gO.x = -15;
gO.y = 128;
gO.width = 16;
gO.height = 16;
gO.newMap = 2;
gO.newLinkX = 236;
gO.newLinkY = 140;
gO.isPortal = true;
gameObjects7_7.push(gO);

gO = new GameObject()
gO.x = 112;
gO.y = 48;
gO.width = 16;
gO.height = 16;
gO.newMap = 4;
gO.newLinkX = 112;
gO.newLinkY = 223;
gO.isPortal = true;
gameObjects7_7.push(gO);

gO = new GameObject()
gO.x = 128;
gO.y = 48;
gO.width = 16;
gO.height = 16;
gO.newMap = 4;
gO.newLinkX = 128;
gO.newLinkY = 223;
gO.isPortal = true;
gameObjects7_7.push(gO);

function MapBundle(m, o)
{
	this.map = m;
	this.gameobjects = o;
}


<!-- /////////////////////////////////////////////////////// -->
<!-- let map0_6 = [ -->
<!-- [ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22], -->
<!-- [ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22], -->
<!-- [ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22], -->
<!-- [ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22], -->
<!-- [ 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61,  2,  2, 61, 61], -->
<!-- [ 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61,  2,  2, 61, 61], -->
<!-- [  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2, 61, 61], -->
<!-- [  2,  2,  2,  2,  2,  2,  2,  2,  7,  2,  2,  2,  2,  2, 60, 61], -->
<!-- [  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  7,  2,  2,  2,  2, 60], -->
<!-- [  2,  2,  7,  2,  2,  7,  2,  2,  7,  2,  2,  2,  2,  2,  2,  2], -->
<!-- [  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  7,  2,  2,  2,  2, 42], -->
<!-- [  2,  2,  2,  2,  2,  2,  2,  2,  7,  2,  2,  2,  2,  2, 42, 61], -->
<!-- [  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2, 61, 61], -->
<!-- [ 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 61, 61], -->
<!-- [ 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61]]; -->

<!-- let gameObjects7_6 = []; -->
<!-- gO = new GameObject() -->
<!-- gO.x = 256; -->
<!-- gO.y = 144; -->
<!-- gO.width = 16; -->
<!-- gO.height = 16; -->
<!-- gO.newMap = 0; -->
<!-- gO.newLinkX = 1; -->
<!-- gO.newLinkY = 140; -->
<!-- gO.isPortal = true; -->
<!-- gameObjects7_6.push(gO); -->

<!-- gO = new GameObject() -->
<!-- gO.x = -16; -->
<!-- gO.y = 96; -->
<!-- gO.width = 16; -->
<!-- gO.height = 16; -->
<!-- gO.newMap = 3; -->
<!-- gO.newLinkX = 239; -->
<!-- gO.newLinkY = 96; -->
<!-- gO.isPortal = true; -->
<!-- gameObjects7_6.push(gO); -->

<!-- gO = new GameObject() -->
<!-- gO.x = -16; -->
<!-- gO.y = 112; -->
<!-- gO.width = 16; -->
<!-- gO.height = 16; -->
<!-- gO.newMap = 3; -->
<!-- gO.newLinkX = 239; -->
<!-- gO.newLinkY = 112; -->
<!-- gO.isPortal = true; -->
<!-- gameObjects7_6.push(gO); -->

<!-- gO = new GameObject() -->
<!-- gO.x = -16; -->
<!-- gO.y = 128; -->
<!-- gO.width = 16; -->
<!-- gO.height = 16; -->
<!-- gO.newMap = 3; -->
<!-- gO.newLinkX = 239; -->
<!-- gO.newLinkY = 128; -->
<!-- gO.isPortal = true; -->
<!-- gameObjects7_6.push(gO); -->

<!-- gO = new GameObject() -->
<!-- gO.x = -16; -->
<!-- gO.y = 144; -->
<!-- gO.width = 16; -->
<!-- gO.height = 16; -->
<!-- gO.newMap = 3; -->
<!-- gO.newLinkX = 239; -->
<!-- gO.newLinkY = 144; -->
<!-- gO.isPortal = true; -->
<!-- gameObjects7_6.push(gO); -->

<!-- gO = new GameObject() -->
<!-- gO.x = -16; -->
<!-- gO.y = 160; -->
<!-- gO.width = 16; -->
<!-- gO.height = 16; -->
<!-- gO.newMap = 3; -->
<!-- gO.newLinkX = 239; -->
<!-- gO.newLinkY = 160; -->
<!-- gO.isPortal = true; -->
<!-- gameObjects7_6.push(gO); -->

<!-- gO = new GameObject() -->
<!-- gO.x = -16; -->
<!-- gO.y = 176; -->
<!-- gO.width = 16; -->
<!-- gO.height = 16; -->
<!-- gO.newMap = 3; -->
<!-- gO.newLinkX = 239; -->
<!-- gO.newLinkY = 176; -->
<!-- gO.isPortal = true; -->
<!-- gameObjects7_6.push(gO); -->

<!-- gO = new GameObject() -->
<!-- gO.x = -16; -->
<!-- gO.y = 192; -->
<!-- gO.width = 16; -->
<!-- gO.height = 16; -->
<!-- gO.newMap = 3; -->
<!-- gO.newLinkX = 239; -->
<!-- gO.newLinkY = 190; -->
<!-- gO.isPortal = true; -->
<!-- gameObjects7_6.push(gO); -->
<!-- /////////////////////////////////////////////////////////////////// -->



let map7_7 = [
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 61, 61, 61, 61, 61, 61, 61,  2,  2, 61, 61, 61, 61, 61, 61, 61],
[ 61, 61, 61, 61, 28, 61, 62,  2,  2, 61, 61, 61, 61, 61, 61, 61],
[ 61, 61, 61, 62,  2,  2,  2,  2,  2, 61, 61, 61, 61, 61, 61, 61],
[ 61, 61, 62,  2,  2,  2,  2,  2,  2, 61, 61, 61, 61, 61, 61, 61],
[ 61, 62,  2,  2,  2,  2,  2,  2,  2, 60, 61, 61, 61, 61, 61, 61],
[  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2],
[ 43, 44,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2, 43, 43],
[ 61, 61,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2, 61, 61],
[ 61, 61,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2, 61, 61],
[ 61, 61, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 61, 61],
[ 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61]];
///////////////////////////////////////////////////////
let map7_6 = [
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61,  2,  2, 61, 61],
[ 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61,  2,  2, 61, 61],
[  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2, 61, 61],
[  2,  2,  2,  2,  2,  2,  2,  2,  7,  2,  2,  2,  2,  2, 60, 61],
[  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  7,  2,  2,  2,  2, 60],
[  2,  2,  7,  2,  2,  7,  2,  2,  7,  2,  2,  2,  2,  2,  2,  2],
[  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  7,  2,  2,  2,  2, 42],
[  2,  2,  2,  2,  2,  2,  2,  2,  7,  2,  2,  2,  2,  2, 42, 61],
[  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2, 61, 61],
[ 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 61, 61],
[ 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61]];

let gameObjects7_6 = [];
gO = new GameObject()
gO.x = 256;
gO.y = 144;
gO.width = 16;
gO.height = 16;
gO.newMap = 0;
gO.newLinkX = 1;
gO.newLinkY = 140;
gO.isPortal = true;
gameObjects7_6.push(gO);

gO = new GameObject()
gO.x = 160;
gO.y = 184;
gO.nextX = 160;
gO.nextY = 184;
////row 10 col 13
gO.width = 16;
gO.height = 16;
gO.isEnemy = true;
gO.enemyType = 1;
gO.isAttacking = false;
gO.health = 1;
gO.direction = "up";
gameObjects7_6.push(gO);

gO = new GameObject()
gO.x = 128;
gO.y = 128;
gO.nextX = 128;
gO.nextY = 128;
////row 10 col 13
gO.width = 16;
gO.height = 16;
gO.isEnemy = true;
gO.enemyType = 1;
gO.isAttacking = false;
gO.health = 1;
gO.direction = "up";
gameObjects7_6.push(gO);

gO = new GameObject()
gO.x = 112;
gO.y = 112;
gO.nextX = 112;
gO.nextY = 112;
////row 10 col 13
gO.width = 16;
gO.height = 16;
gO.isEnemy = true;
gO.enemyType = 1;
gO.isAttacking = false;
gO.health = 1;
gO.direction = "up";
gameObjects7_6.push(gO);

gO = new GameObject()
gO.x = -16;
gO.y = 96;
gO.width = 16;
gO.height = 16;
gO.newMap = 3;
gO.newLinkX = 239;
gO.newLinkY = 96;
gO.isPortal = true;
gameObjects7_6.push(gO);

gO = new GameObject()
gO.x = -16;
gO.y = 112;
gO.width = 16;
gO.height = 16;
gO.newMap = 3;
gO.newLinkX = 239;
gO.newLinkY = 112;
gO.isPortal = true;
gameObjects7_6.push(gO);

gO = new GameObject()
gO.x = -16;
gO.y = 128;
gO.width = 16;
gO.height = 16;
gO.newMap = 3;
gO.newLinkX = 239;
gO.newLinkY = 128;
gO.isPortal = true;
gameObjects7_6.push(gO);

gO = new GameObject()
gO.x = -16;
gO.y = 144;
gO.width = 16;
gO.height = 16;
gO.newMap = 3;
gO.newLinkX = 239;
gO.newLinkY = 144;
gO.isPortal = true;
gameObjects7_6.push(gO);

gO = new GameObject()
gO.x = -16;
gO.y = 160;
gO.width = 16;
gO.height = 16;
gO.newMap = 3;
gO.newLinkX = 239;
gO.newLinkY = 160;
gO.isPortal = true;
gameObjects7_6.push(gO);

gO = new GameObject()
gO.x = -16;
gO.y = 176;
gO.width = 16;
gO.height = 16;
gO.newMap = 3;
gO.newLinkX = 239;
gO.newLinkY = 176;
gO.isPortal = true;
gameObjects7_6.push(gO);

gO = new GameObject()
gO.x = -16;
gO.y = 192;
gO.width = 16;
gO.height = 16;
gO.newMap = 3;
gO.newLinkX = 239;
gO.newLinkY = 190;
gO.isPortal = true;
gameObjects7_6.push(gO);
///////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////
let map7_5 = [
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 61, 61, 61, 61,  2, 97, 97, 61, 61, 61, 61, 61, 61, 61, 61, 61],
[ 61, 61, 28, 62,  2, 97, 97, 61, 61, 61, 61, 61, 61, 61, 61, 61],
[ 61, 62,  2,  2,  2, 97, 97,  2,  2,  2,  2,  2,  2,  2,  2,  2],
[ 61,  2,  2,  2,  2, 97, 97,  2,  7,  2,  2,  2,  7,  2,  2,  2],
[ 61,  2,  2,  2,  2, 97, 97,  2,  2,  2,  7,  2,  2,  2,  2,  2],
[ 61,  2,  2,  7,  2, 97, 97,  2,  7,  2,  2,  2,  7,  2,  2,  2],
[ 61,  2,  2,  2,  2, 97, 97,  2,  2,  2,  7,  2,  2,  2,  2,  2],
[ 61,  2,  2,  2,  2, 97, 97,  2,  7,  2,  2,  2,  7,  2,  2,  2],
[ 61,  2,  2,  2,  2, 97, 97,  2,  2,  2,  2,  2,  2,  2,  2,  2],
[ 61, 43, 43, 43, 43, 97, 97, 43, 43, 43, 43, 43, 43, 43, 43, 43],
[ 61, 61, 61, 61, 61, 97, 97, 61, 61, 61, 61, 61, 61, 61, 61, 61]];

let gameObjects7_5 = [];
gO = new GameObject()
gO.x = 256;
gO.y = 96;
gO.width = 16;
gO.height = 16;
gO.newMap = 2;
gO.newLinkX = 1;
gO.newLinkY = 96;
gO.isPortal = true;
gameObjects7_5.push(gO);

gO = new GameObject()
gO.x = 256;
gO.y = 112;
gO.width = 16;
gO.height = 16;
gO.newMap = 2;
gO.newLinkX = 1;
gO.newLinkY = 112;
gO.isPortal = true;
gameObjects7_5.push(gO);

gO = new GameObject()
gO.x = 160;
gO.y = 184;
gO.nextX = 160;
gO.nextY = 184;
////row 10 col 13
gO.width = 16;
gO.height = 16;
gO.isEnemy = true;
gO.enemyType = 1;
gO.isAttacking = false;
gO.health = 1;
gO.direction = "up";
gameObjects7_5.push(gO);

gO = new GameObject()
gO.x = 32;
gO.y = 96;
gO.nextX = 32;
gO.nextY = 96;
////row 10 col 13
gO.width = 16;
gO.height = 16;
gO.isEnemy = true;
gO.enemyType = 1;
gO.isAttacking = false;
gO.health = 1;
gO.direction = "up";
gameObjects7_5.push(gO);

gO = new GameObject()
gO.x = 256;
gO.y = 128;
gO.width = 16;
gO.height = 16;
gO.newMap = 2;
gO.newLinkX = 1;
gO.newLinkY = 128;
gO.isPortal = true;
gameObjects7_5.push(gO);

gO = new GameObject()
gO.x = 256;
gO.y = 144;
gO.width = 16;
gO.height = 16;
gO.newMap = 2;
gO.newLinkX = 1;
gO.newLinkY = 144;
gO.isPortal = true;
gameObjects7_5.push(gO);

gO = new GameObject()
gO.x = 256;
gO.y = 160;
gO.width = 16;
gO.height = 16;
gO.newMap = 2;
gO.newLinkX = 1;
gO.newLinkY = 160;
gO.isPortal = true;
gameObjects7_5.push(gO);

gO = new GameObject()
gO.x = 256;
gO.y = 176;
gO.width = 16;
gO.height = 16;
gO.newMap = 2;
gO.newLinkX = 1;
gO.newLinkY = 176;
gO.isPortal = true;
gameObjects7_5.push(gO);

gO = new GameObject()
gO.x = 256;
gO.y = 192;
gO.width = 16;
gO.height = 16;
gO.newMap = 2;
gO.newLinkX = 1;
gO.newLinkY = 190;
gO.isPortal = true;
gameObjects7_5.push(gO);
///////////////////////////////////////////////////////////////////


///////////////////////////////////////////////////////////////////
let mapWoodSword = [
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55],
[ 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55],
[ 55, 55, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 55, 55],
[ 55, 55, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 55, 55],
[ 55, 55, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 55, 55],
[ 55, 55, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 55, 55],
[ 55, 55, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 55, 55],
[ 55, 55, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 55, 55],
[ 55, 55, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 55, 55],
[ 55, 55, 37, 37, 37, 37, 37, 28, 28, 37, 37, 37, 37, 37, 55, 55],
[ 55, 55, 55, 55, 55, 55, 55, 28, 28, 55, 55, 55, 55, 55, 55, 55]];

let gameObjectsWoodSword = [];
///Portal variables
gO = new GameObject()
gO.x = 112;
gO.y = 240;
gO.width = 16;
gO.height = 16;
gO.newMap = 0;
gO.newLinkX = 68;
gO.newLinkY = 96;
gO.isPortal = true;
gameObjectsWoodSword.push(gO);

gO = new GameObject()
gO.x = 128;
gO.y = 240;
gO.width = 16;
gO.height = 16;
gO.newMap = 0;
gO.newLinkX = 68;
gO.newLinkY = 96;
gO.isPortal = true;
gameObjectsWoodSword.push(gO);
///////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////
let map131 = [
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 55, 55, 55, 55, 55,  2,  2,  2,  2, 90, 91, 91, 91, 91, 91, 91],
[ 55, 55, 55, 55, 55,  2,  2,  2,  2, 90, 91, 91, 91, 91, 91, 91],
[ 55, 55, 55, 55, 55,  2,  2,  2,  2, 90, 91, 91, 91, 91, 91, 91],
[ 56, 54, 55, 55, 56,  2,  2,  2,  2, 90, 91, 91, 91, 91, 91, 91],
[  2,  2,  2,  2,  2,  2,  2,  2,  2, 90, 91, 91, 91, 91, 91, 91],
[ 73, 73, 73, 73, 73, 73, 73, 73, 73,131, 91, 91, 91, 91, 91, 91],
[ 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91],
[ 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91],
[ 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91],
[ 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91],
[ 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91, 91]];

let gameObjects131 = [];
///Portal variables
gO = new GameObject()
gO.x = 112;
gO.y = 240;
gO.width = 16;
gO.height = 16;
gO.newMap = 0;
gO.newLinkX = 68;
gO.newLinkY = 96;
gO.isPortal = true;
gameObjects131.push(gO);

gO = new GameObject()
gO.x = 128;
gO.y = 240;
gO.width = 16;
gO.height = 16;
gO.newMap = 0;
gO.newLinkX = 68;
gO.newLinkY = 96;
gO.isPortal = true;
gameObjects131.push(gO);
///////////////////////////////////////////////////////////////////
let map107 = [
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22],
[ 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61],
[ 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61],
[ 61, 62,  2,  2,  2,  2,  2,  2,  2, 60, 62,  2,  2,  2, 60, 61],
[ 62,  2,  2,  7,  2,  7,  2,  2,  2,  2,  2,  2,  7,  2,  2, 60],
[  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2],
[  2,  2,  2,  7,  2,  7,  2,  2,  2,  2,  2,  2,  7,  2,  2,  2],
[  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2],
[ 44,  2,  2,  7,  2,  7,  2,  2,  2,  2,  2,  2,  7,  2,  2, 42],
[ 61, 44,  2,  2,  2,  2,  2,  2,  2, 42, 44,  2,  2,  2, 42, 61],
[ 61, 61, 43, 43, 43, 43, 43,  2,  2, 61, 61, 43, 43, 43, 61, 61],
[ 61, 61, 61, 61, 61, 61, 61,  2,  2, 61, 61, 61, 61, 61, 61, 61]];
let gameObjects107 = [];

gO = new GameObject();
gO.x = 112;
gO.y = 224;
gO.width = 16;
gO.height = 16;
gO.newMap = 134;
gO.newLinkX = 112;
gO.newLinkY = 65;
gO.isPortal = true;
gameObjects107.push(gO);





maps.push(new MapBundle(map7_7, gameObjects7_7));
maps.push(new MapBundle(mapWoodSword, gameObjectsWoodSword));
maps.push(new MapBundle(map7_6, gameObjects7_6));
maps.push(new MapBundle(map7_5, gameObjects7_5));
maps.push(new MapBundle(map107, gameObjects107));

gameObjects = maps[3].gameobjects;
gameMap = maps[3].map;

function keyDownHandler(e){
    if(e.keyCode == 37)
    {
	   leftPressed = true;
	   lastButtonPressed = "left";
	}
	else if(e.keyCode == 39)
	{
	   rightPressed = true;
	   lastButtonPressed = "right";
	}
	else if(e.keyCode == 38)
	{
	   upPressed = true;
	   lastButtonPressed = "up";
	}
	else if(e.keyCode == 40)
	{
	   downPressed = true;
	   lastButtonPressed = "down";
	}
	
	if(e.keyCode == 32 && canAttackAgain){
            isAttacking = true;
			currentAnimation = 0;
			canAttackAgain = false;
        }
	
}

function keyUpHandler(e){
    if(e.keyCode == 37)
	{
	   leftPressed = false;
	}
	else if(e.keyCode == 39)
	{
	   rightPressed = false;
	}
	else if(e.keyCode == 38)
	{
	   upPressed = false;
	}
	else if(e.keyCode == 40)
	{
	   downPressed = false;
	}
	
	if(e.keyCode == 32){
            //isAttacking = false;
        }
}

function drawMap(level)
{
	for(let i = 0; i < level.length; i++)
	{
		for(let j = 0; j < level[i].length; j++)
		{
			ctx.drawImage(worldTiles, ((level[i][j]%18) * 17) + 1,
			(Math.floor(level[i][j]/18) * 17) + 1, 
			16, 16, j *16, i *16, 16, 16);
		}
	}
}

function drawLink()
{
	let speed = 2;
	animationCounter++;
	if(isAttacking && hasSword)
	{
		if(currentAnimation == 0)
			{
				if(lastButtonPressed == "down")
				{
					ctx.drawImage(link1, 0, 60, 
					16, 16, linkX, linkY, 16, 16);
				}
				if(lastButtonPressed == "up")
				{
					ctx.drawImage(link1, 62, 60, 
					16, 16, linkX, linkY, 16, 16);
				}
				if(lastButtonPressed == "left")
				{
					ctx.drawImage(link1, 30, 60, 
					16, 16, linkX, linkY, 16, 16);
				}
				if(lastButtonPressed == "right")
				{
					ctx.drawImage(link1, 91, 60, 
					16, 16, linkX, linkY, 16, 16);
				}
			}
			else if(currentAnimation == 1)
			{
				if(lastButtonPressed == "down")
				{
					ctx.drawImage(link1, 0, 84, 
					16, 27, linkX, linkY, 16, 27);
				}
				if(lastButtonPressed == "up")
				{
					ctx.drawImage(link1, 62, 84, 
					16, 26, linkX, linkY-14, 16, 26);
				}
				if(lastButtonPressed == "left")
				{
					ctx.drawImage(link1, 22, 84, 
					26, 27, linkX - 10, linkY - 8, 27, 27);
				}
				if(lastButtonPressed == "right")
				{
					ctx.drawImage(link1, 84, 84, 
					30, 26, linkX, linkY - 8, 26, 26);
				};
			}
			if(animationCounter >= 6)
			{
				currentAnimation++;
				animationCounter = 0;
				if(currentAnimation > 1)
				{
					currentAnimation = 0;
					isAttacking = false;
					canAttackAgain = true;
					
				}
			}
	}
	else if(leftPressed && !collision2(linkX - speed, linkY, gameMap))
	{
			linkX -= speed;
			if(currentAnimation == 0)
			{
				ctx.drawImage(link1, 30, 0, 16, 16, linkX, linkY, 16, 16);
			}
			else if(currentAnimation == 1)
			{
				ctx.drawImage(link1, 30, 30, 16, 16,linkX, linkY, 16, 16);
			}
			if(animationCounter >= 6)
			{
				currentAnimation++;
				animationCounter = 0;
				if(currentAnimation > 1)
				{
					currentAnimation = 0;
				}
			}
	}
	else if(rightPressed && !collision2(linkX + speed, linkY, gameMap))
	{
		linkX += speed;
		if(currentAnimation == 0)
			{
				ctx.drawImage(link1, 91, 0, 16, 16, linkX, linkY, 16, 16);
			}
			else if(currentAnimation == 1)
			{
				ctx.drawImage(link1, 91, 30, 16, 16,linkX, linkY, 16, 16);
			}
			if(animationCounter >= 6)
			{
				currentAnimation++;
				animationCounter = 0;
				if(currentAnimation > 1)
				{
					currentAnimation = 0;
				}
			}
	}
	else if(upPressed && !collision2(linkX, linkY - speed, gameMap))
	{
		linkY -= speed;
		if(currentAnimation == 0)
			{
				ctx.drawImage(link1, 62, 0, 16, 16, linkX, linkY, 16, 16);
			}
			else if(currentAnimation == 1)
			{
				ctx.drawImage(link1, 62, 30, 16, 16,linkX, linkY, 16, 16);
			}
			if(animationCounter >= 6)
			{
				currentAnimation++;
				animationCounter = 0;
				if(currentAnimation > 1)
				{
					currentAnimation = 0;
				}
			}
	}
	else if(downPressed && !collision2(linkX, linkY + speed, gameMap))
	{
		linkY += speed;
		if(currentAnimation == 0)
			{
				ctx.drawImage(link1, 0, 0, 16, 16, linkX, linkY, 16, 16);
			}
			else if(currentAnimation == 1)
			{
				ctx.drawImage(link1, 0, 30, 16, 16,linkX, linkY, 16, 16);
			}
			if(animationCounter >= 6)
			{
				currentAnimation++;
				animationCounter = 0;
				if(currentAnimation > 1)
				{
					currentAnimation = 0;
				}
			}
	}
	
	else
	{
		if(lastButtonPressed == "down")
		{
			ctx.drawImage(link1, 0, 0, 
			16, 16, linkX, linkY, 16, 16);
		}
		if(lastButtonPressed == "up")
		{
			ctx.drawImage(link1, 62, 0, 
			16, 16, linkX, linkY, 16, 16);
		}
		if(lastButtonPressed == "left")
		{
			ctx.drawImage(link1, 30, 0, 
			16, 16, linkX, linkY, 16, 16);
		}
		if(lastButtonPressed == "right")
		{
			ctx.drawImage(link1, 91, 0, 
			16, 16, linkX, linkY, 16, 16);
		}
	}
}

function Point(x, y)
{
	this.row = x;
	this.col = y;
}

function collision2(x, y, map)
{
	
	blocks = [];
	
	for(let i = 0; i < map.length; i++)
	{
		for(let j = 0; j < map[i].length; j++)
			{
				if(map[i][j] != 2 && map[i][j] != 28 &&
				map[i][j] != 18)
				{
					blocks.push(new Point(i, j));
				}
			}
	}

	for(let i = 0; i < blocks.length; i++)
		{
			if (x <= blocks[i].col*16 + 16 &&
			   x + 10 >= blocks[i].col*16 &&
			   y + 10 <= blocks[i].row*16 + 16 &&
			   y + 16 >= blocks[i].row*16 ) {
					return true;
				}
		}
	return false;	
}

function drawGameObjects()
{
	for(let i = 0; i < gameObjects.length; i++)
	{
		if(gameObjects[i].isEnemy)
		{
			if(gameObjects[i].enemyType == 1)
			{
				gameObjects[i].counter++;
				if(gameObjects[i].x == gameObjects[i].nextX &&
				gameObjects[i].y == gameObjects[i].nextY)
				{
					gameObjects[i].nextX = -1;
					gameObjects[i].nextY = -1;
				}
				
				
				if(gameObjects[i].enemyPath.length == 0)
				{
					let currRow = Math.floor(gameObjects[i].y/16);
					let currCol = Math.floor(gameObjects[i].x/16);
					getNewCoordinates(currRow, currCol);
					gameObjects[i].enemyPath = copyArray(pathFound);
				}
			
				
				if(gameObjects[i].enemyPath[0] != null && 
				gameObjects[i].nextX == -1 && 
				gameObjects[i].nextY == -1)
				{
					gameObjects[i].nextX = gameObjects[i].enemyPath[0].col * 16;
					gameObjects[i].nextY = gameObjects[i].enemyPath[0].row * 16;
					gameObjects[i].enemyPath.splice(0,1);
				}
				if(gameObjects[i].counter >= 10)
				{
					gameObjects[i].frame++;
					gameObjects[i].counter = 0;
					if(gameObjects[i].frame > 1)
					{
						gameObjects[i].frame = 0;
					}
				}
				if(gameObjects[i].direction == "down")
				{
					if(gameObjects[i].frame == 0)
					{
						ctx.drawImage(enemies, 0, 0, 16, 16, 
						gameObjects[i].x, gameObjects[i].y, 16, 16);
					}
					if(gameObjects[i].frame == 1)
					{
						ctx.drawImage(enemies, 0, 30, 16, 16, 
						gameObjects[i].x, gameObjects[i].y, 16, 16);
					}
				}
				else if(gameObjects[i].direction == "up")
				{
					if(gameObjects[i].frame == 0)
					{
						ctx.drawImage(enemies, 60, 0, 16, 16, 
						gameObjects[i].x, gameObjects[i].y, 16, 16);
					}
					if(gameObjects[i].frame == 1)
					{
						ctx.drawImage(enemies, 60, 30, 16, 16, 
						gameObjects[i].x, gameObjects[i].y, 16, 16);
					}
				}
				else if(gameObjects[i].direction == "left")
				{
					if(gameObjects[i].frame == 0)
					{
						ctx.drawImage(enemies, 30, 0, 16, 16, 
						gameObjects[i].x, gameObjects[i].y, 16, 16);
					}
					if(gameObjects[i].frame == 1)
					{
						ctx.drawImage(enemies, 30, 30, 16, 16, 
						gameObjects[i].x, gameObjects[i].y, 16, 16);
					}
				}
				else
				{
					if(gameObjects[i].frame == 0)
					{
						ctx.drawImage(enemies, 90, 0, 16, 16, 
						gameObjects[i].x, gameObjects[i].y, 16, 16);
					}
					if(gameObjects[i].frame == 1)
					{
						ctx.drawImage(enemies, 90, 30, 16, 16, 
						gameObjects[i].x, gameObjects[i].y, 16, 16);
					}
				}
				
				
				if(gameObjects[i].x != gameObjects[i].nextX)
				{
					if(gameObjects[i].nextX > gameObjects[i].x)
					{
						if(gameObjects[i].counter%3 == 0)
						{
							gameObjects[i].x += 1;
						}
						gameObjects[i].direction = "right";
					}
					else if(gameObjects[i].nextX < gameObjects[i].x)
					{
						if(gameObjects[i].counter%3 == 0)
						{
							gameObjects[i].x -= 1;
						}
						gameObjects[i].direction = "left";
					}
					
				}
				else if(gameObjects[i].y != gameObjects[i].nextY)
				{
					if(gameObjects[i].nextY > gameObjects[i].y)
					{
						if(gameObjects[i].counter%3 == 0)
						{
							gameObjects[i].y += 1;
						}
						gameObjects[i].direction = "down";
					}
					else if(gameObjects[i].nextY < gameObjects[i].y)
					{
						if(gameObjects[i].counter%3 == 0)
						{
							gameObjects[i].y -= 1;
						}
						gameObjects[i].direction = "up";
					}
				}
			}
		}
	}
}


function getNewCoordinates(currentRow, currentCol)
{
	pathFound = [];
	let randRow = Math.floor(Math.random() * 11) + 4;
	let randCol = Math.floor(Math.random() * 16);
	
	//while(randRow > 14 || randRow < 0 ||
	//randCol > 15 || randRow < 0 ||
	while(gameMap[randRow][randCol] != 2)
	{
		randRow = Math.floor(Math.random() * 11) + 4;
	    randCol = Math.floor(Math.random() * 16);
	}
	///0-11 + 4 for rows
	//console.log("Game map at randRow and randCol: " + gameMap[randRow][randCol]);
	//console.log("Target node is: " + randRow + "   " + randCol);
	foundPath(currentRow, currentCol, randRow, randCol);
	while(pathFound.length == 0)
	{
		console.log("Old path didnt work, need new path..");
		randRow = Math.floor(Math.random() * 12) + 4;
		randCol = Math.floor(Math.random() * 16);
		foundPath(currentRow, currentCol, randRow, randCol);
	}
	
	//return new Point(randRow, randCol);
	
}

function foundPath(cR, cC, tR, tC)
{
	let visitedNodes = [];
	let currentNodes = [];
	if(cC >= 1 && gameMap[cR][cC - 1] == 2)
	{
		currentNodes.push(new Point(cR, cC - 1));
	}
	if(cC <= 14 && gameMap[cR][cC + 1] == 2)
	{
		currentNodes.push(new Point(cR, cC + 1));
	}
	if(cR >= 5 && gameMap[cR - 1][cC] == 2)
	{
		currentNodes.push(new Point(cR - 1, cC));
	}
	if(cR <= 14 && gameMap[cR + 1][cC] == 2)
	{
		currentNodes.push(new Point(cR + 1, cC));
	}
	//console.log("CurrentNodes: ");
	//console.log(currentNodes);
	visitedNodes.push(new Point(cR, cC));
	for(let i = 0; i < currentNodes.length; i++)
	{	
		visitedNodes.push(new Point(currentNodes[i].row,currentNodes[i].col ));
		if(currentNodes[i].row == tR &&
		currentNodes[i].col == tC)
		{
			pathFound = visitedNodes;
			break;
		}
		findRestOfRoute(currentNodes[i].row, currentNodes[i].col, 
						tR, tC, visitedNodes)
	}
	
}

function isInNodes(targetR, targetC, nodes)
{
	let isInList = false;
	for(let i = 0; i < nodes.length; i++)
	{
		if(nodes[i].row == targetR && nodes[i].col == targetC)
		{
			isInList = true;
			break;
		}
	}
	return isInList;
}

function copyArray(arr)
{
	let arr2 = [];
	for(let i = 0; i < arr.length; i++)
	{
		arr2.push(new Point(arr[i].row, arr[i].col));
	}
	return arr2;
}

function findRestOfRoute(cR, cC, tR, tC, vNodes2)
{
	let vNodes = copyArray(vNodes2);
	
	let currentNodes = [];
	
	if(cC >= 1 && gameMap[cR][cC - 1] == 2)
	{
		if(!isInNodes(cR, cC - 1, vNodes))
		{
			currentNodes.push(new Point(cR, cC - 1));
		}
	}
	if(cC <= 14 && gameMap[cR][cC + 1] == 2)
	{
		if(!isInNodes(cR, cC + 1, vNodes))
		{
			currentNodes.push(new Point(cR, cC + 1));
		}
	}
	if(cR >= 5 && gameMap[cR - 1][cC] == 2)
	{
		if(!isInNodes(cR - 1, cC, vNodes))
		{
			currentNodes.push(new Point(cR - 1, cC));
		}
	}
	if(cR <= 14 && gameMap[cR + 1][cC] == 2)
	{
		if(!isInNodes(cR +1, cC, vNodes))
		{
			currentNodes.push(new Point(cR + 1, cC));
		}
	}
	if(currentNodes.length == 0 || pathFound.length > 0 || 
		vNodes.length > 30)
	{
		return;
	}
	
	for(let i = 0; i < currentNodes.length; i++)
	{	
		vNodes.push(new Point(currentNodes[i].row, currentNodes[i].col));
		if(currentNodes[i].row == tR &&
		currentNodes[i].col == tC)
		{
			pathFound = copyArray(vNodes);
			//console.log("Path was found.");
			return;

		}
		findRestOfRoute(currentNodes[i].row, currentNodes[i].col, 
		tR, tC, vNodes);
	}
	
}


function gameObjectCollision(x, y, objects, isLink, isSword, isBomb, isCandle, isArrow, direction)
{
	if(isLink)
	{
		for(let i = 0; i < objects.length; i++)
			{
				if (x <= objects[i].x + objects[i].width &&
				   x + 16 >= objects[i].x &&
				   y  <= objects[i].y + objects[i].height &&
				   y + 16 >= objects[i].y ) {
						if(objects[i].isPortal)
						{
							gameMap = maps[objects[i].newMap].map;
							gameObjects = maps[objects[i].newMap].gameobjects;
							linkX = objects[i].newLinkX;
							linkY = objects[i].newLinkY;
							
						}
						if(objects[i].isEnemy)
						{
							//
							linkNeedsToBounce = true;
						}
					}
			}
	}
	else
	{
		for(let i = 0; i < objects.length; i++)
			{
			if (x <= objects[i].x + objects[i].width &&
			x >= objects[i].x &&
			y  <= objects[i].y + objects[i].height &&
			y >= objects[i].y ) 
			{
				if(objects[i].isEnemy)
						{
							//
							objects[i].health -= 1;
							objects[i].needsBounce = true;
							
							objects[i].bounceX = 
							objects[i].bounceY = 
						}
			}
		}
	}
}

function getBounceLoc(gObject, ignoresObjects, direction)
{
	let bX = 0;
	let bY = 0;
	let currRow = Math.floor(gameObjects[i].y/16);
	let currCol = Math.floor(gameObjects[i].x/16);
	if(direction == "up")
	{
		if(gameMap[currRow-1][currCol] == 2)
		{
			gObject.x -= 16;
		}
	}
	return new Point(bX, bY);
}

function drawHUD()
{
	ctx.drawImage(hud, 258, 11, 256, 56, 
				0, 0, 256, 56);
	ctx.drawImage(hud, 2, 112, 16, 64, 
				176, 32, 64,  16);
	//draw Hearts
	let fullHearts = Math.floor(currentLinkHearts)
	let halfHearts = currentLinkHearts - fullHearts;
	for(let i = 0; i < linkHearts; i++)
	{
		let heartY = 40;
		let heartX = 176 + (i * 8);
		if(i > 7)
			{
				heartY = 40 - 8;
				heartX -= 64;
			}
			else
			{
				heartY = 40;
			}
		ctx.drawImage(hud, 627, 117, 8, 8, 
				heartX, heartY, 8, 8);
	}
	let halfHeartX = 0;
	let halfHeartY = 0;
	for(let i = 0; i < fullHearts; i++)
	{
		let heartY = 40;
		let heartX = 176 + (i * 8);
		if(i > 7)
			{
				heartY = 40 - 8;
				heartX -= 64;
			}
			else
			{
				heartY = 40;
			}
		ctx.drawImage(hud, 645, 117, 8, 8, 
				heartX, heartY, 8, 8);
		if(i == fullHearts - 1)
		{
			halfHeartX = 176 + (i * 8) + 8 - 64;
			if(i > 7)
			{
				halfHeartY = 40 - 8;
			}
			else
			{
				halfHeartY = 40;
			}
		}	
	}
	
	if(halfHearts > 0)
	{
		ctx.drawImage(hud, 636, 117, 8, 8, 
				halfHeartX, halfHeartY, 8, 8);
	}
}


function draw () {
   setTimeout(function() {
   requestAnimationFrame(draw);
   ctx.fillStyle = "rgb(20,20,20)";
   ctx.fillRect(0,0,800,600);
   ///all code goes here
    
	drawMap(gameMap);
	drawLink();
	gameObjectCollision(linkX, linkY, gameObjects, true, false, false, false, false);
	drawGameObjects();
	drawHUD();
   },1000/fps);
}
draw();

</script>
</body>
</html>

